
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CloudCreate Debug</title>
  <style>
    body { font-family: sans-serif; background: #f7f7f7; padding: 2rem; }
    input, button { padding: 0.6rem; font-size: 1rem; width: 100%; margin-bottom: 1rem; }
    img { max-width: 100%; margin-top: 1rem; border-radius: 8px; }
    textarea { width: 100%; height: 150px; font-family: monospace; font-size: 0.9rem; }
  </style>
</head>
<body>
  <h2>üß™ CloudCreate Debug Mode</h2>
  <input id="prompt" placeholder="Type your prompt..." value="A luxury hotel lobby with modern design" />
  <button onclick="generate()">Generate Image</button>
  <p id="status">Waiting...</p>
  <img id="result" />
  <h3>Debug Log:</h3>
  <textarea id="log" readonly></textarea>

  <script>
    const status = document.getElementById("status");
    const log = document.getElementById("log");
    const result = document.getElementById("result");
    const token = "r8_TZhyNvUVnXB3VCGiYKg4n7OO9H5Wt504S90KA";

    async function generate() {
      const prompt = document.getElementById("prompt").value;
      status.textContent = "üü° Sending request...";
      result.src = "";
      log.value = "";

      try {
        const predictionRes = await fetch("https://api.replicate.com/v1/predictions", {
          method: "POST",
          headers: {
            Authorization: `Token ${token}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            version: "c508d555f95b44258d8fe204f6c4c86c4e37b6cb2cfadd9e123a6cd5b731b204",
            input: { prompt }
          })
        });

        const prediction = await predictionRes.json();
        log.value += "[CREATE RESPONSE]\n" + JSON.stringify(prediction, null, 2) + "\n\n";

        if (!prediction.urls || !prediction.id) {
          status.textContent = "‚ùå Failed to start generation.";
          return;
        }

        const getUrl = prediction.urls.get;
        status.textContent = "‚è≥ Waiting for image...";

        let pollResult = null;
        while (!pollResult) {
          await new Promise(r => setTimeout(r, 3000));
          const res = await fetch(getUrl, {
            headers: { Authorization: `Token ${token}` }
          });
          const data = await res.json();
          log.value += "[POLL]\n" + JSON.stringify(data, null, 2) + "\n\n";
          if (data.status === "succeeded") {
            pollResult = data.output[0];
            result.src = pollResult;
            status.textContent = "‚úÖ Image ready.";
          } else if (data.status === "failed") {
            status.textContent = "‚ùå Generation failed.";
            break;
          }
        }
      } catch (err) {
        status.textContent = "‚ùå Error: " + err.message;
        log.value += "ERROR: " + err.stack;
      }
    }
  </script>
</body>
</html>
